<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>üêã k8s up and running - üçé SRE Journey</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> üõ∂ Introduction</a></li><li class="chapter-item expanded "><a href="becoming_sre.html"><strong aria-hidden="true">2.</strong> üìö Becoming SRE</a></li><li class="chapter-item expanded "><a href="k8s.html"><strong aria-hidden="true">3.</strong> üö¢ k8s</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="k8s_up_and_running.html" class="active"><strong aria-hidden="true">3.1.</strong> üêã k8s up and running</a></li><li class="chapter-item expanded "><a href="k8s_personal_notes.html"><strong aria-hidden="true">3.2.</strong> ‚õµÔ∏è k8s personal notes</a></li><li class="chapter-item expanded "><a href="k8s_cheatsheet.html"><strong aria-hidden="true">3.3.</strong> üìù k8s cheatsheet</a></li></ol></li><li class="chapter-item expanded "><a href="elk_stack.html"><strong aria-hidden="true">4.</strong> üìà ELK Stack</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">üçé SRE Journey</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="-k8s-up-and-running"><a class="header" href="#-k8s-up-and-running">üêã k8s up and running</a></h1>
<blockquote>
<p>‚ö†Ô∏è These are notes taken from the book <a href="https://learning.oreilly.com/library/view/kubernetes-up-and/9781098110192"><em>Kubernetes Up and Running by Brendan
Burns, Joe Beda, and Kelsey Hightower O'Reilly</em></a>.
<strong>Please go read it and just use this as reference</strong>.</p>
</blockquote>
<h1 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h1>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#development-velocity">Development Velocity</a></li>
<li><a href="#scaling-your-service-and-your-teams">Scaling Your Service and Your Teams</a>
<ul>
<li><a href="#decoupling">Decoupling</a></li>
<li><a href="#scaling-for-applications-and-clusters">Scaling for Applications and Clusters</a></li>
<li><a href="#scaling-development-teams">Scaling Development Teams</a></li>
<li><a href="#separation-of-concerns-for-consistency-and-scaling">Separation of Concerns for Consistency and Scaling</a></li>
</ul>
</li>
<li><a href="#abstracting-you-infrastructure">Abstracting You Infrastructure</a></li>
<li><a href="#efficiency">Efficiency</a></li>
<li><a href="#cloud-native-ecosystem">Cloud Native Ecosystem</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
<li><a href="#deploying-a-k8s-cluster">Deploying a k8s cluster</a>
<ul>
<li><a href="#cluster-components">Cluster Components</a></li>
</ul>
</li>
<li><a href="#common-kubectl-commands">Common <code>kubectl</code> commands</a>
<ul>
<li><a href="#namespaces">Namespaces</a></li>
<li><a href="#contexts">Contexts</a></li>
<li><a href="#viewing-k8s-api-objects">Viewing k8s API Objects</a></li>
<li><a href="#creating-updating-and-destroying-k8s-objects">Creating, updating and destroying k8s objects</a></li>
<li><a href="#labeling-and-annotating-objects">Labeling and Annotating Objects</a></li>
<li><a href="#debugging-commands">Debugging Commands</a></li>
<li><a href="#cluster-management">Cluster Management</a></li>
</ul>
</li>
</ul>
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<aside>
üí° K8s is an open source orchestrator for deploying containerized applications
</aside>
<p>It has become the standard API for building cloud native applications. It
provides the software needed for build and deploy, reliable, scalable
distributed systems.</p>
<p><strong>Distributed systems:</strong> Most services nowadays are delivered via the network,
they have different moving parts in different machines talking to each other
over the network via APIs.</p>
<p><strong>Reliable:</strong> Since we rely a lot on these distributed systems, they cannot
fail, even if some part of them crashes, they need to be kept up and running,
and be fault-tolerant</p>
<p><strong>Availability:</strong> They must still be available during maintenance, updates,
software rollouts and so on.</p>
<p><strong>Scalable:</strong> We live in a highly connected society, so these systems need to
be able to grow their capacity without radical redesign of the distributed
systems.</p>
<p>Most of the reasons people come to use containers and container orchestration
like k8s, can be boil down to 5 things:  <strong>velocity, scaling, abstracting your
infra, efficiency, cloud native ecosystem</strong></p>
<h2 id="development-velocity"><a class="header" href="#development-velocity">Development Velocity</a></h2>
<p>Today software is delivered via de network more quickly than ever, but velocity
is not just a matter of raw speed, people are more interested in a highly
reliable service, all users expect constant uptime, even as the software is
being updated.</p>
<p>Velocity is measures in term of the number of things you can ship while
maintaining a highly available service.</p>
<p>k8s give you the tools to to do this, the core concepts to enable this are:</p>
<ul>
<li>
<p><strong>Immutability</strong></p>
<p>Software used to be mutable (imperative), you installed <code>vim</code> using <code>dnf</code>
and then one day you would do <code>dnf update</code>  and it would add modifications
on top of the binary that you already have for <code>vim</code>. This is what we call
<em>mutable</em> software.</p>
<p>On the other hand, <em>immutable</em> software, you would not add on top of the
previous release, you would build the image from zero. Which is how
containers work. Basically when you want to update something in a
container, you do not go inside it and do <code>dnf update vim</code> you create a new
image with the version of vim you want, destroy the old one, and create a
container with the new one.</p>
<p>This makes rollbacks way easier, and it keeps tracks of what changed from
version to version.</p>
  <aside>
  üí° Imperatively change running containers (going into the container and
  update a package for example) is an anti-pattern, and should be avoided.
  </aside>
</li>
<li>
<p><strong>Declarative Configuration</strong></p>
<p>This is an extension of immutability but for the configuration. It
basically means that you have a file where you defined the ideal state of
your system. The idea of storing this files in source control is often
called ‚Äúinfrastructure as code‚Äù.</p>
<p>The combination of declarative state stored in a version control system and
the ability of k8s to make it  match the state makes rollback super easy.</p>
</li>
<li>
<p><strong>Self-Healing Systems</strong></p>
<p>K8s will continuously take action to make sure the state on the declarative
configuration is met. Say it has declared 3 replicas, then if you go and
create one extra, it will kill it, and if you were to destroy one, it would
create it.</p>
<p>This means that k8s will not only init your system but will guard it
against any failures that might destabilize it.</p>
</li>
</ul>
<h2 id="scaling-your-service-and-your-teams"><a class="header" href="#scaling-your-service-and-your-teams">Scaling Your Service and Your Teams</a></h2>
<p>K8s is great for scaling because of its decoupled architecture.</p>
<h3 id="decoupling"><a class="header" href="#decoupling">Decoupling</a></h3>
<p>In a decoupled architecture each components is separated from each other by
defined APIs and service loads</p>
<p>This basically means that we can isolate each service.</p>
<ul>
<li>The API provide a buffer between implementer and consumer.</li>
<li>Load balancing provide a buffer between running instances of each service.</li>
</ul>
<p>When we decouple the services, it makes it easier to scale, since each small
team can focus on a single <em>microservice</em></p>
<h3 id="scaling-for-applications-and-clusters"><a class="header" href="#scaling-for-applications-and-clusters">Scaling for Applications and Clusters</a></h3>
<p>Since your app is deployed in containers, which are immutable, and th
configuration o  is also declarative, scaling simply becomes a matter of
changing a number in a configuration file. Or you can even tell k8s to do that
for you.</p>
<p>Of course k8s will be limited to the resources you have, it will not create a
physical computer on demand. But k8s makes it easier to scale the cluster
itself as well.</p>
<p>Since a set of machines in a cluster are identical and the apps are decoupled
from the specifics of the machine by containers, scaling a cluster is just a
matter of provisioning the system and joining it to a cluster.</p>
<p>K8s can also come in handy when trying to forecast costs on growth and scaling.
Basically, if you have different apps that need to scale from many teams, you
can aggregate them all in a single k8s, and try to forecast the usage of the 3
apps together.</p>
<h3 id="scaling-development-teams"><a class="header" href="#scaling-development-teams">Scaling Development Teams</a></h3>
<p>Teams are ideal when using the two-pizza team when (6 to 8 people), larger
teams tend to have issues of hierarchy, poor visibility, infighting and so on.</p>
<p>K8s can help with that, since you can have multiple small teams working on
different microservices and  aggregate them all into a single k8s cluster.</p>
<p>K8s has different abstractions that make it easier to build decoupled
microservices.</p>
<ul>
<li><strong>pods</strong>: are groups of containers, can contain images developed by different
teams into a single deployable unit.</li>
<li><strong>k8s services</strong>: provide load balancing, naming and discovery to isolate the
microservices.</li>
<li><strong>namespaces</strong>: provide isolation and access control, so that each microservice
can control the degree to which other services interact with it.</li>
<li><strong>ingress</strong>: easy to use front end that can combine microservices into a single
API.</li>
</ul>
<h3 id="separation-of-concerns-for-consistency-and-scaling"><a class="header" href="#separation-of-concerns-for-consistency-and-scaling">Separation of Concerns for Consistency and Scaling</a></h3>
<p>K8s leads to greater consistency for the lower levels of the infrastructure.
Basically the devs need to only worry about their app meeting the SLA (service
level agreements) while the orchestration admin only need to worry about
reaching the SLA from their side.</p>
<h2 id="abstracting-you-infrastructure"><a class="header" href="#abstracting-you-infrastructure">Abstracting You Infrastructure</a></h2>
<p>When you build your app in terms of containers and deploy it via k8s APIs, you
make moving your app between environments super easy. It is simply a question
of sending the declarative config to a new cluster.</p>
<p>K8s make building deploying and managing your app truly portable across a wide
variety of environments</p>
<h2 id="efficiency"><a class="header" href="#efficiency">Efficiency</a></h2>
<p>Efficiency is measured by the ratio of the useful work performed by a machine.</p>
<p>K8s enables efficiency in multiple ways. Since developers do not need to use a
whole machine for himself/herself, but rather one container, multiple users can
share the same baremetal. Meaning less idle CPUs.</p>
<h2 id="cloud-native-ecosystem"><a class="header" href="#cloud-native-ecosystem">Cloud Native Ecosystem</a></h2>
<p>K8s is open source and has a huge community building a thousand things on top
of it. You can check the maturity of different projects in Cloud Native
Computing Foundation. The maturities are sandbox incubating and graduated,
going from less mature to most mature.</p>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Fundamentally k8s was design to give developers more velocity efficiency and
agility. Now that we have seen why to use it, lets see how to use it.</p>
<h1 id="deploying-a-k8s-cluster"><a class="header" href="#deploying-a-k8s-cluster">Deploying a k8s cluster</a></h1>
<p>You can use a cloud provider, deploying on  bare-metal quite hard, other good
alternatives.</p>
<p><a href="http://kind.sigs.k8s.io/docs/user/configuration/">http://kind.sigs.k8s.io</a>
that has a really cool logo, and works on using containers for the nodes.</p>
<p>Go check the pages of cloud providers on how to deploy it there since it will
change depending on the provider.</p>
<p>One thing to bare in mind is that in order to use <code>kubectl</code> with your cluster
you need a <code>~/.kube/config</code> file, probably your cloud provider will give that
to you.</p>
<p>Also you can go to <a href="/k8s_cheatsheet.html#describe-cluster">k8s cheatsheet (describe
cluster)</a> to see the basics commands on
describing a cluster.</p>
<p>I will  just cover some of the commands here, like</p>
<pre><code class="language-bash">k describe nodes &lt;node name&gt;
</code></pre>
<p>At the top you can see basic node info:</p>
<pre><code>Name:               kind-control-plane
Roles:              control-plane
Labels:             beta.kubernetes.io/arch=arm64
                    beta.kubernetes.io/os=linux
                    kubernetes.io/arch=arm64
</code></pre>
<p>We can see that it is linux on ARM</p>
<p>Next we can see info about the operation of the node</p>
<pre><code>Conditions:
Type             Status  LastHeartbeatTime  LastTransitionTime Reason                       Message
----             ------  -----------------  ------------------ ------                       -------
MemoryPressure   False   29 Apr 2024        29 Apr 2024        KubeletHasSufficientMemory   kubelet has sufficient memory available
DiskPressure     False   29 Apr 2024        29 Apr 2024        KubeletHasNoDiskPressure     kubelet has no disk pressure
PIDPressure      False   29 Apr 2024        29 Apr 2024        KubeletHasSufficientPID      kubelet has sufficient PID available
Ready            True    29 Apr 2024        29 Apr 2024        KubeletReady                 kubelet is posting ready status
</code></pre>
<p>Here we can see that the node is Ready, that it has sufficient memory, it has
no disk pressure, and that is has sufficient PID.</p>
<p>Then we see info about the capacity of the system.</p>
<pre><code>Capacity:
cpu:             1
memory:          1933908Ki
pods:            110
Allocatable:
cpu:             1
memory:          1933908Ki
pods:            110
</code></pre>
<p>Then info about software in the node like OS image, docker version all that.</p>
<pre><code>System Info:
# more stuff
Kernel Version:             6.5.6-200.fc38.aarch64
OS Image:                   Debian GNU/Linux 12 (bookworm)
Operating System:           linux
Architecture:               arm64
Container Runtime Version:  containerd://1.7.13
Kubelet Version:            v1.29.2
Kube-Proxy Version:         v1.29.2
</code></pre>
<p>Then info about the pods running on the node:</p>
<pre><code>Non-terminated Pods:          (9 in total)
Namespace                   Name                                          CPU Requests  CPU Limits  Memory Requests  Memory Limits  Age
---------                   ----                                          ------------  ----------  ---------------  -------------  ---
kube-system                 coredns-76f75df574-92286                      100m (10%)    0 (0%)      70Mi (3%)        170Mi (9%)     23s
kube-system                 coredns-76f75df574-m2z2k                      100m (10%)    0 (0%)      70Mi (3%)        170Mi (9%)     23s
kube-system                 etcd-kind-control-plane                       100m (10%)    0 (0%)      100Mi (5%)       0 (0%)         39s
kube-system                 kindnet-qm29d                                 100m (10%)    100m (10%)  50Mi (2%)        50Mi (2%)      23s
kube-system                 kube-apiserver-kind-control-plane             250m (25%)    0 (0%)      0 (0%)           0 (0%)         39s
# more stuff
</code></pre>
<p>We can see that k8s tracks both <code>requests</code> and upper <code>limits</code> for resource for
each Pod. The difference is that resources requested by a pod are guaranteed to
be present in the node, while pod's limit is the max amount of given resource
that pod can consume</p>
<h2 id="cluster-components"><a class="header" href="#cluster-components">Cluster Components</a></h2>
<p>Many components that make up the k8s cluster are actually deployed using k8s
itself. All of them run in the kube-system namespace</p>
<ul>
<li>
<p>k8s proxy</p>
<p>It routes network traffic to load-balanced services in the k8s cluster. It
must be present on every node in the cluster</p>
<pre><code class="language-bash">% k get daemonSets --namespace=kube-system kube-proxy
</code></pre>
</li>
<li>
<p>k8s dns</p>
<p>provides naming and discover for the services that are defined in the
cluster</p>
<pre><code class="language-bash">% k get deployments --namespace=kube-system coredns
</code></pre>
</li>
</ul>
<h1 id="common-kubectl-commands"><a class="header" href="#common-kubectl-commands">Common <code>kubectl</code> commands</a></h1>
<blockquote>
<p>I will repeat the commands here and in the page: <a href="/k8s_cheatsheet.html">k8s
cheatsheet</a> but I will go a bit more into detail here.
I will also <code>alias k=kubectl</code></p>
</blockquote>
<p><code>kubectl</code> is the way you talk with k8s API. Here we will go over basic
<code>kubectl</code> commands.</p>
<h2 id="namespaces"><a class="header" href="#namespaces">Namespaces</a></h2>
<p>Namespaces are like folders that hold a set of objects. They are used to
organize the cluster.</p>
<p>By default the <code>kubectl</code> command interacts with the <code>default</code> namespace, but
you can specify which you want to use by <code>-n</code> or <code>--namespace=&lt;ns&gt;</code>.</p>
<p>You can also use <code>--all-namespaces</code> flag to refer to all the ns.</p>
<h2 id="contexts"><a class="header" href="#contexts">Contexts</a></h2>
<p>If you want to change the namespaces in a more <em>permanent</em> way, you can use
contexts. These get recorded in your <code>~/.kube/config</code> file. (That file also
stores how to find and auth to your cluster)</p>
<p>You can create a with a different default namespaces using</p>
<pre><code class="language-bash">% kubectl config set-context my-context --namespace=mystuff
</code></pre>
<p>We need to tell <code>kubectl</code> to start using it.</p>
<pre><code class="language-bash">% kubectl config use-context my-context
</code></pre>
<p>You can also use context to manage different clusters users for auth using
<code>--users</code> or <code>--cluster</code> flags with <code>set-context</code> read the man for more info</p>
<h2 id="viewing-k8s-api-objects"><a class="header" href="#viewing-k8s-api-objects">Viewing k8s API Objects</a></h2>
<p>Basically k8s is an API and kubectl is just an http client. To see the k8s
objects (everything represented by a RESTful resource) we use <code>k get &lt;resource name&gt;</code></p>
<p>By default it will throw to the STDOUT human readable stuff, but you can also
use <code>-o json</code> or <code>-o yaml</code> in case you want it in specific format.</p>
<p>Also when using <code>awk</code> you may want to use <code>--no-haders</code>.</p>
<p>You can also get multiple objects</p>
<pre><code class="language-bash">k get pods,services
</code></pre>
<p>To get more info on a particular object</p>
<pre><code class="language-bash">k describe &lt;resource name&gt; &lt;obj name&gt;
</code></pre>
<p>If you want to  see like a mini man page of an specific k8s object:</p>
<pre><code class="language-bash">% k explain pods
KIND:       Pod
VERSION:    v1

DESCRIPTION:
    Pod is a collection of containers that can run on a host. This resource is
    created by clients and scheduled onto hosts.

FIELDS:
  apiVersion	&lt;string&gt;
    APIVersion defines the versioned schema of this representation of an object.
    Servers should convert recognized schemas to the latest internal value, and
    may reject unrecognized values. More info:

</code></pre>
<p>Sometimes you want to continually observe the state of a k8s resource, like
when waiting for an app to restart of something you can use the <code>--watch</code> flag:</p>
<pre><code>k get pods -n kube-system --watch
</code></pre>
<h2 id="creating-updating-and-destroying-k8s-objects"><a class="header" href="#creating-updating-and-destroying-k8s-objects">Creating, updating and destroying k8s objects</a></h2>
<p>Objects in the k8s API are represented as JSON or YAML files. We can query the
server for those, or post them with an API request.</p>
<p>You use these JSON and YAML files to create, update or delete objects in your
k8s server.</p>
<p><strong>Create</strong> an object from <code>obj.yaml</code> file.</p>
<pre><code class="language-bash">% k apply -f obj.yaml
</code></pre>
<p>The yaml file will have the resource type of the object.</p>
<p>You can use the same command to <strong>update</strong> an object</p>
<pre><code class="language-bash">% k apply -f obj.yaml
</code></pre>
<p>If nothing change it will not do anything, it will exit successfully, good for
<code>for</code> loops. You can do <code>--dry-run</code> to print objects to the terminal without
actually sending them.</p>
<p>To do interactive edits you can use</p>
<pre><code class="language-bash">% k edit &lt;resource-name&gt; &lt;obj-name&gt;
# example k edit pod coredns-76f75df574-k97nj  -n kube-system
</code></pre>
<p>It will open the <code>yaml</code> in a text editor, wonce you save it will automatically
be uploaded back to the k8s cluster.</p>
<p>The <code>apply</code> command also has a history of the previous configurations
<code>edit-last-applied</code>, <code>set-last-applied</code> and <code>view-last-applied</code> for example:</p>
<pre><code class="language-bash">% k apply -f myobj.yaml view-last-applied
</code></pre>
<p>To delete you can simply run</p>
<pre><code class="language-bash">% k delete -f myobj.yaml
</code></pre>
<p>You can also delete an object without the file using</p>
<pre><code class="language-bash">% k delete &lt;resource-name&gt; &lt;obj-name&gt;
</code></pre>
<h2 id="labeling-and-annotating-objects"><a class="header" href="#labeling-and-annotating-objects">Labeling and Annotating Objects</a></h2>
<p>You can update the labels and annotations using <code>label</code> and <code>annotate</code> (who
would have thought).</p>
<p>For example to add the <code>color=red</code> label to the pod named <code>bar</code> you can run:</p>
<pre><code class="language-bash">k label pods bar color=red
</code></pre>
<p>You can not rewrite unless using <code>--overwrite</code> flag.</p>
<p>Finally you can remove a label by doing</p>
<pre><code class="language-bash">k labels pods bar color-
</code></pre>
<h2 id="debugging-commands"><a class="header" href="#debugging-commands">Debugging Commands</a></h2>
<p>You can check logs from a pod by:</p>
<pre><code class="language-bash">k logs &lt;pod-name&gt;
</code></pre>
<p>If you have multiple container in your pods you can choose which container to
view using the <code>-c</code> flag.</p>
<p>If you want to follow add <code>-f</code>.</p>
<p>You can also use the <code>exec</code> command to execute a command in a running
container.</p>
<pre><code class="language-bash">k exec -it &lt;pod-name&gt; -- bash
</code></pre>
<p>If you do not have bash or a shell in your container, you can <code>attach</code> to a
running process</p>
<pre><code class="language-bash">k attach -it &lt;pod-name&gt;
</code></pre>
<p>You can also copy files to and from a container using <code>cp</code></p>
<pre><code class="language-bash">k cp &lt;pod-name&gt;:/path/to/remote/file /path/to/local/file
</code></pre>
<p>This will copy a file from the container to your local machine.</p>
<p>You can also forward traffic from your local system to the pod</p>
<pre><code class="language-bash">k port-forward &lt;pod name&gt; 8080:80
</code></pre>
<p>Forwards traffic from the local machine on port 8080 to the remote container on
port 80</p>
<p>If you want to see the last 10 events in a namespace</p>
<pre><code>k get events
</code></pre>
<p>You can also stream events <code>--watch</code></p>
<p>Finally,  to check cluster resources being used</p>
<pre><code>k top nodes
</code></pre>
<p>or</p>
<pre><code>k top pods
</code></pre>
<p>These commands will only work if metrics servers are present, which they likely
are.</p>
<h2 id="cluster-management"><a class="header" href="#cluster-management">Cluster Management</a></h2>
<p>Cordon and drain a particular node:</p>
<ul>
<li><em>cordon</em>: prevent future pods form being scheduled onto that machine</li>
<li><em>drain</em>: remove any pods that are currently running on that machine.</li>
</ul>
<p>Useful for removing physical machine for repairs or upgrades. You would do <code>k cordon</code> and then <code>k drain</code> to safely remove the machine form the cluster.</p>
<p>Once the system is back online do <code>k uncordon</code> there is no <code>undrain</code> it will
naturally get back to normal.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="k8s.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="k8s_personal_notes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="k8s.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="k8s_personal_notes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
